#
# ### Continuous Integration (CI)
# Ensure that code successfully builds
#
# Required pipeline variables
# - azureAppServiceName: Name of the Azure App Service for backend deployment
# - dockerRegistryEndpoint: Service connection to the Docker registry
# - dockerUserName: Registry organization/user prefix
#

trigger:
  branches:
    include:
    - main

pool:
  vmImage: 'ubuntu-latest'

variables:
- template: vars/vars-all.yaml
- template: vars/vars-ci.yaml

steps:
- template: steps/git-checkout-self.yaml
- template: steps/use-dotnet-sdk.yaml
  parameters:
    version: '10.x'
- template: steps/build-solution.yaml
- template: steps/run-tests.yaml
- template: steps/docker-compose-build.yaml
- template: steps/run-functional-tests.yaml
- template: steps/build-nuxt.yaml
- template: steps/publish-nuxt.yaml
- template: steps/publish-web-archive.yaml

# Deploy Steps
# Add these into a separate stage
# TODO: - template: steps/docker-compose-push.yaml
# TODO: - template: steps/deploy-nuxt.yaml
# TODO: - template: steps/deploy-web.yaml
